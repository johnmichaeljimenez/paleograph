<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Paleograph</title>

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.4/css/bulma.min.css">
	<link href="styles.css" rel="stylesheet">

	<script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
	<script type="module" src="/script.js"></script>
</head>

<body x-data="app">

	<section class="section">
		<button class="button" @click="fileNew()">New</button>
		<button class="button" @click="fileOpen()">Open</button>
		<button class="button" @click="fileSave()">Save</button>

		<div class="tabs is-boxed is-medium">
			<ul>
				<li :class="{ 'is-active': tab === 'form' }">
					<a @click="tab = 'form'">Form</a>
				</li>
				<li :class="{ 'is-active': tab === 'report' }">
					<a @click="tab = 'report'">Report</a>
				</li>
				<li :class="{ 'is-active': tab === 'info' }">
					<a @click="tab = 'info'">Info</a>
				</li>
			</ul>
		</div>

		<div class="container" x-show="tab === 'form'">
			<form @submit.prevent="run">

				<div class="field">
					<label class="label is-medium">Target Directory</label>
					<div class="control">
						<input class="input is-medium" type="text" x-model="form.sourcePath" required>
					</div>
				</div>

				<div class="field">
					<label class="label is-medium">Custom Prompt</label>
					<div class="control">
						<textarea class="textarea is-medium" x-model="form.customPrompt"></textarea>
					</div>
				</div>

				<div class="field">
					<label class="label is-medium">Whitelist Extensions (pipe separated)</label>
					<div class="control">
						<input class="input is-medium" type="text" x-model="whitelistString">
					</div>
				</div>

				<div class="field">
					<label class="label is-medium">Blacklist Folders (pipe separated)</label>
					<div class="control">
						<input class="input is-medium" type="text" x-model="blacklistString">
					</div>
				</div>

				<div class="field">
					<div class="control">
						<label class="checkbox">
							<input type="checkbox" x-model="form.dryRun"> Dry Run
						</label>
					</div>
				</div>

				<div class="field">
					<div class="control">
						<button class="button is-primary" type="submit">Run</button>
					</div>
				</div>
			</form>
		</div>

		<div class="container" x-show="tab === 'report'">
			<div x-show="newData?.output?.textBlob?.length == 0">
				No Report available
			</div>

			<div x-show="newData?.output?.textBlob?.length > 0">
				Date: <span x-text="newData.output.dateGenerated"></span><br>
				<div x-html="renderedReport"></div>
			</div>
		</div>
		</div>

		<div class="container" x-show="tab === 'info'">
			<div x-show="newData?.output?.textBlob?.length == 0">
				No Report available
			</div>
			
			<div x-show="newData?.output?.textBlob?.length > 0">
				Tokens: <span x-text="newData.output.tokenCount"></span><br>
				Cost: $<span x-show="newData.output.tokenCost > 0" x-text="newData.output.tokenCost"></span>
				<button @click="copyBlob()">Copy</button>
				<div x-text="newData.output.textBlob" style="white-space: pre-line;">

				</div>
			</div>
		</div>

	</section>
</body>

</html>